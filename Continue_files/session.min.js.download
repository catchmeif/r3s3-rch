var sessionTimeoutWidget=new function(){function ut(n){return n.parent==n?n:(n=n.parent,ut(n))}var y,p=this,u,w,f,b,k,i,d,s,g,h,c,l,nt,tt,e,n,t,r,a,it="sessionTimeoutMsg",o,ft;this.initialize=function(){ft()&&(g=$("#"+w),n=ut(parent).document,e=n.title,et(),o())};var et=function(){$(n).bind("keypress click scroll",rt),$(document).bind("keypress click scroll",rt),f&&document.getElementById(f).setAttribute("onclick","sessionTimeoutWidget.finishLaterPopupButtonClick();"),document.getElementById(b).setAttribute("onclick","sessionTimeoutWidget.refreshButtonClick()"),document.getElementById(k).setAttribute("onclick","sessionTimeoutWidget.cancelButtonClick()")},ot=function(){var i,s,n,e,o,f;if(t=u*60,i=u.toString(),i.length==1&&(i="0"+i),s=c.replace("{0}",i+": 00"),$("#"+h).text(s),objUtilities.showLoading(g.html(),it+" defaultcursor"),r=!0,ht(),n=$(".sessionTimeoutMsg button"),n.length>0)for(n[0].focus(),n[0].tabindex=1,n[1].tabindex=2,$(n[1]).bind("keydown",function(t){t.keyCode=="9"&&(n[0].focus(),t.preventDefault())}),e=function(t){t.target!=n[0]&&t.target!=n[1]&&n[0].focus()},$(document.body).bind("keydown",e),o=function(){$(document.body).unbind("keydown",e)},f=0;f<n.length;f++)$(n[f]).bind("click",o),$(n[f]).bind("keyup",function(n){n.keyCode=="13"&&o()})},v=function(){objUtilities.stopLoading(),r=!1,ct()},rt=function(){r||(s=!0)};this.refreshButtonClick=function(){return v(),p.refreshSession(o),!1},this.finishLaterPopupButtonClick=function(){i&&i&&(v(),document.getElementById(i)&&document.getElementById(i).click())},this.cancelButtonClick=function(){return v(),!1},this.refreshSession=function(n,t,i){$.ajax({type:"POST",data:{locale:locale},url:nt,success:function(i){if(i.indexOf("session_error_panel")==-1)n&&n();else{objUtilities.isSessionValid=!1,objUtilities.showLoading(i,"blockMsg defaultcursor sessionTimeoutMsg");var u=function(n){n.keyCode=="9"&&($("#startNewUrl").focus(),n.preventDefault())},r=function(n){n.keyCode=="13"&&$(document.body).unbind("keydown",onBodyClick)};$(document.body).bind("keydown",u),$("#startNewUrl").bind("keyup",r),$("#startNewUrl").bind("click",r),t&&t()}},error:function(){a&&objUtilities.showLoading($("#"+a).html(),"blockMsg defaultcursor sessionTimeoutMsg"),i&&i()}})};var st=function(){s?p.refreshSession(o):ot()},ht=function(){tt=setInterval(function(){lt()},1e3)},ct=function(){clearInterval(tt),n.title=e},lt=function(){var o,i,s,u,a;t>0?(t--,o=Math.floor(t%60),i=o.toString(),i.length==1&&(i="0"+i),s=Math.floor(t/60%60),u=s.toString(),u.length==1&&(u="0"+u),a=c.replace("{0}",u+": "+i),$(".loadIndicator").find("#"+h).html(a)):t==0&&($("."+it).find("#"+f).hide(),!l||$(".loadIndicator").find(".actionsMsg").html(l),t--),r&&(n.title=n.title==e?"____________________":e)};o=function(){s=!1,setTimeout(function(){st()},d*1e3)},ft=function(){try{var n=sessionTimeoutWidgetParams;return!n||!n.Timeout||!n.MinutesBeforeTimeout||!n.MessagePanelId||!n.RefreshSessionButtonId||!n.CancelButtonId||!n.SessionExpireMessageLabelId||!n.SessionExpireMessageTemplate||!n.RefreshAction?!1:(y=n.Timeout,u=n.MinutesBeforeTimeout,w=n.MessagePanelId,f=n.FinishLaterMessageButtonId,b=n.RefreshSessionButtonId,k=n.CancelButtonId,i=n.FinishLaterPageButtonId,h=n.SessionExpireMessageLabelId,c=n.SessionExpireMessageTemplate,l=n.ExpiredActionsMessage,nt=n.RefreshAction,d=(y-u)*60,a=n.ErrorPanelId,r=!1,!0)}catch(t){return!1}}};
